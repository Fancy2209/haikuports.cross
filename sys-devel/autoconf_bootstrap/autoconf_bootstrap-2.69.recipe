SUMMARY="A tool for automatically configuring source code"
DESCRIPTION="
	GNU Autoconf is a tool for configuring source code and makefiles. Using
	autoconf, programmers can create portable and configurable packages,
	because the person building the package is allowed to specify various
	configuration options.
	"
HOMEPAGE="http://www.gnu.org/software/autoconf/"
COPYRIGHT="1992-2012 Free Software Foundation, Inc."
LICENSE="
	GNU GPL v2
	GNU GPL v3
	"
SRC_URI="http://ftp.gnu.org/gnu/autoconf/autoconf-2.69.tar.gz"
CHECKSUM_SHA256="954bd69b391edc12d6a4a51a2dd1476543da5c6bbf05a95b59dc0dd6fd4c2969"
REVISION="2"
ARCHITECTURES="x86_gcc2 x86 x86_64 ppc arm"

PATCHES="autoconf_bootstrap-2.69.patchset"

PROVIDES="
	autoconf_bootstrap = $portVersion compat >= 2.60
	autoconf = $portVersion compat >= 2.60
	cmd:autoconf = $portVersion compat >= 2.60
	cmd:autoheader = $portVersion compat >= 2.60
	cmd:autom4te = $portVersion compat >= 2.60
	cmd:autoreconf = $portVersion compat >= 2.60
	cmd:autoscan = $portVersion compat >= 2.60
	cmd:autoupdate = $portVersion compat >= 2.60
	cmd:ifnames = $portVersion compat >= 2.60
	"
REQUIRES="
	haiku >= $haikuVersion
	cmd:awk
	coreutils
	diffutils
	cmd:m4 >= 1.4
	cmd:perl >= 5
	cmd:sh
	"
BUILD_REQUIRES="
	"
BUILD_PREREQUIRES="
	haiku_devel >= $haikuVersion
	binutils_cross_$targetArchitecture
	gcc_cross_$targetArchitecture
	cmd:aclocal >= 1.13
	cmd:automake >= 1.13
	cmd:autoreconf >= 2.60
	cmd:make
	cmd:makeinfo
	cmd:sed
	"

BUILD_PACKAGE_ACTIVATION_PHASE=INSTALL
SOURCE_DIR="autoconf-$portVersion"

BUILD()
{
	# fix path to perl in scripts using it
	for file in autoheader autom4te autoreconf autoscan autoupdate ifnames; do
		sed -i -e "s,@PERL@,`which perl`,g" bin/${file}.in
	done

	touch man/*.1

	autoreconf
	PERL="perl" M4="m4" SED="sed" \
		runConfigure ./configure \
		--build=$buildMachineTriple --host=$targetMachineTriple
	make $jobArgs
}

INSTALL()
{
	make DESTDIR=$installDestDir install

	# fix path to perl in scripts using it
	cd $packagingBaseDir/$portName/bin
	PERLPATH=$portPackageLinksDir/cmd~perl/bin/perl
	for file in autoheader autom4te autoreconf autoscan autoupdate ifnames; do
		sed -i -e "s, `which perl`, $PERLPATH,g" $file
	done
}
