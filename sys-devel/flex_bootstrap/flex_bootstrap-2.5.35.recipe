SUMMARY="A tool for generating scanners."
DESCRIPTION="
	Flex is a fast lexical analyser generator. It is a tool for generating
	programs that perform pattern-matching on text.
	"
HOMEPAGE="http://flex.sourceforge.net/"
LICENSE="Flex"
COPYRIGHT="2001-2007 The Flex Project; 1990, 1997 The Regents of the University of California"
SRC_URI="http://sourceforge.net/projects/flex/files/flex/flex-2.5.35/flex-2.5.35.tar.bz2"
CHECKSUM_SIZE="1256501"
CHECKSUM_MD5="10714e50cea54dc7a227e3eddcd44d57"
CHECKSUM_RMD160="4827f940e227f9d2f454c021f69dd1c7ad3e76f4"
CHECKSUM_SHA512="aa5aebbc7ccaa4697d7f0cfa3ba899dd3b327bc8551ba341c26bece7f9044951d0532e3ebf6ec63760204b4ff805f9f957d064e9a213ef8aac428e565de31343"
REVISION="1"
ARCHITECTURES="x86_gcc2 x86 x86_64 ppc arm"

PATCHES="flex_bootstrap-2.5.35.patchset"

PROVIDES="
	flex_bootstrap = $portVersion compat >= 2.5
	flex = $portVersion compat >= 2.5
	cmd:flex = $portVersion compat >= 2.5
	lib:libfl.a = $portVersion compat >= 2.5
	lib:libfl_pic.a = $portVersion compat >= 2.5
	"
REQUIRES="
	haiku >= $haikuVersion
	cmd:m4
	"
BUILD_REQUIRES="
	"
BUILD_PREREQUIRES="
	haiku_devel >= $haikuVersion
	binutils_cross_$targetArchitecture
	gcc_cross_$targetArchitecture
	cmd:aclocal
	cmd:autoconf
	cmd:automake
	cmd:libtoolize
	cmd:make
	"

SOURCE_DIR="flex-$portVersion"

BUILD()
{
	libtoolize --force --copy --install
	./autogen.sh
	export ac_cv_func_malloc_0_nonnull=yes
	export ac_cv_func_realloc_0_nonnull=yes
	runConfigure ./configure \
		--build=$buildMachineTriple --host=$targetMachineTriple \
		--disable-rpath --disable-nls --with-gnu-ld
	make $jobArgs AR=$targetMachineTriple-ar
}

INSTALL()
{
	make DESTDIR=$installDestDir install

	$targetMachineTriple-strip $installDestDir$binDir/*

	rm -r $installDestDir$developDir
	rm -r $installDestDir$infoDir
	rm -r $installDestDir$libDir
}
